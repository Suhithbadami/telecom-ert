<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Call History</title>
    <style>
        /* Optional: Add some styling to the buttons for better visibility */
        button {
            margin-right: 10px;
        }
        
        body {
             background: linear-gradient(135deg, #7117EA, #EA6060) ; 
            color: white !important;
            min-height: 70vh; 
            padding-top: 1px;
        }
    </style>
    <script>
        function filterCalls(callType) {
            var rows = document.querySelectorAll('.call-row');
            
            rows.forEach(function(row) {
                var type = row.children[1].textContent.trim(); // Assuming callType is the second column

                // Convert both callType and type to lowercase for case-insensitive comparison
                if (callType.toLowerCase() === 'all' || type.toLowerCase() === callType.toLowerCase()) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

function updateDateTime() {
    var rows = document.querySelectorAll('.call-row');

    rows.forEach(function (row) {
        var callDateElement = row.querySelector('.call-date');
        var startTimeElement = row.querySelector('.start-time');
        var endTimeElement = row.querySelector('.end-time');

        // Get the current date and time
        var now = new Date();
        var formattedDate = now.toLocaleDateString(); // Format date as needed
        var formattedTime = now.toLocaleTimeString(); // Format time as needed

        callDateElement.textContent = formattedDate;
        startTimeElement.textContent = formattedTime;

        // Calculate end time based on start time and call duration
        var callDuration = parseInt(row.querySelector('.call-duration').textContent);
        if (!isNaN(callDuration)) {
            // Convert call duration to milliseconds
            var callDurationMilliseconds = callDuration * 60 * 1000; // Convert minutes to milliseconds

            // Parse the start time from the element content
            var startTimeString = startTimeElement.textContent;
            var startTime = new Date(formattedDate + ' ' + startTimeString);

            // Calculate end time by adding call duration to start time
            var endTime = new Date(startTime.getTime() + callDurationMilliseconds);

            // Format and set the end time in the element
            endTimeElement.textContent = formatTime(endTime);
        }
    });
}

function formatTime(date) {
    // Implement your own time formatting logic here
    return date.toLocaleTimeString();
}

        // Helper function to format time as needed
        function formatTime(date) {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var seconds = date.getSeconds();

            // Ensure leading zeros for single-digit minutes and seconds
            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = seconds < 10 ? '0' + seconds : seconds;

            return hours + ':' + minutes + ':' + seconds;
        }

        // Update the current date, time, and end time on page load
        window.onload = function () {
            updateDateTime();
        };

        // Update the current date, time, and end time after the Thymeleaf rendering
        document.addEventListener('DOMContentLoaded', function () {
            updateDateTime();
        });
    </script>
    <style>
    table {
            border-collapse: collapse; /* Collapse table borders */
            width: 100%; /* Make table span the full width */
        }

        th, td {
            padding: 8px; /* Add padding to table cells */
            text-align: left; /* Align text to the left within cells */
        }

         body {
              background: linear-gradient(135deg, #7117EA, #EA6060) ; 
            color: white;
            min-height: 100vh; 
            padding-top: 1px;
        }

        /* Style the header row with a white background */
        .header-row th {
            background-color: white ! important;
            color: black;
        }
        </style>
</head>
<body>
    <h1>Call History</h1>
    <div>
        <button onclick="filterCalls('All')">All</button>
        <button onclick="filterCalls('Incoming')">Incoming</button>
        <button onclick="filterCalls('Outgoing')">Outgoing</button>
    </div>

    <table>
        <tr class="header-row">
            <th>id</th>
            <th>Call Type</th>
            <th>Call Date</th>
            <th>Call Duration</th>
            <th>Mobile Number</th>
            <th>Start Time</th>
            <th>End Time</th>
        </tr>
        <tr th:each="callHistory : ${callHistoryList}" data-call-type="${callHistory.callType}" class="call-row">
            <td th:text="${callHistory.id}"></td>
            <td th:text="${callHistory.callType}"></td>
            <td class="call-date"></td>
            <td class="call-duration" th:text="${callHistory.callDuration}"></td>
            <td th:text="${callHistory.mobileNumber}"></td>
            <td class="start-time"></td>
            <td class="end-time"></td>
        </tr>
    </table>
</body>
</html>